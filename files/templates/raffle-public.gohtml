<!doctype html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:type" content="website">
    <meta property="og:title" content="{{.Title}}">
    <meta property="og:description" content="Lightning raffle with {{number .PrizesCount "prize"}}">

    <link rel="stylesheet" media="all" href="/static/public.css">
    <script src="/static/utils.js"></script>

    <title>{{.Title}}</title>

</head>
<body>

<h1 class="raffle">{{.Title}}</h1>

<main>
    {{if .QrCodes}}
        <div id="qr-codes" class="lnurl">
            {{range $i, $qrCode := .QrCodes}}
                <a href="lightning:{{$qrCode.LnUrl}}"{{if gt $i 0}} hidden="hidden"{{end}}>
                    <img id="raffle-qr-code" src="{{$qrCode.Uri}}" alt="LNURL-pay">
                </a>
            {{end}}
        </div>
        <div class="buttons">
            <div class="controls">
                <button id="minus" onclick="changeQrCode(-1)">â€“</button>
                <div id="quantity"></div>
                <button id="plus" onclick="changeQrCode(+1)">+</button>
            </div>
            <button class="secondary" onclick="openLightningWallet()">Open in Lightning wallet</button>
            <button class="secondary" onclick="copyToClipboard(this)">Copy to clipboard</button>
        </div>
    {{else}}
        <p>Raffle already drawn.</p>
    {{end}}
</main>

<script>
    const qrCodeElements = element('qr-codes').children
    const quantityElement = element('quantity')
    const minusButton = element('minus')
    const plusButton = element('plus')

    let qrCodeIndex = 0

    updateQuantity()

    function changeQrCode(delta) {
        qrCodeElements[qrCodeIndex].hidden = true
        qrCodeElements[qrCodeIndex + delta].hidden = false
        qrCodeIndex += delta
        updateQuantity()
    }

    function updateQuantity() {
        const quantity = qrCodeIndex + 1
        quantityElement.innerHTML = `<strong>${quantity}</strong> ticket${quantity !== 1 ? 's' : ''}`
        minusButton.disabled = quantity === 1
        plusButton.disabled = quantity === 10
    }

    function openLightningWallet() {
        navigateTo(qrCodeElements[qrCodeIndex].href)
    }

    function copyToClipboard(button) {
        writeTextToClipboard(qrCodeElements[qrCodeIndex].href, button)
    }
</script>

</body>
</html>
